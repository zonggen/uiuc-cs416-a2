<!DOCTYPE html>
<html lang="en">
<script src='https://d3js.org/d3.v5.min.js'></script>
<style>
  circle {
    fill: lightblue;
    stroke: black;
  }
</style>

<head>
  <title>Data visualization</title>
  <meta content="text/html; charset=utf-8" />
</head>

<body onload='init()'>
  <svg width=300 height=300>
  </svg>
  <script>
    async function init() {

      const width = 200
      const height = 200
      const margin = 50
      var data = await d3.csv("https://flunky.github.io/cars2017.csv");
      console.log(data)
      var x = d3.scaleLog().base(10).domain([10, 150]).range([0, width])
      var y = d3.scaleLog().base(10).domain([10, 150]).range([height, 0])
      d3.select('svg')
        .attr("width", width + 2 * margin).attr("height", height + 2 * margin)
        .append("g").attr("transform", "translate(" + margin + "," + margin + ")")
        .selectAll('circle')
        .data(data)
        .enter()
        .append('circle')
        .attr('cx', (d, _) => x(d.AverageCityMPG))
        .attr('cy', (d, _) => y(d.AverageHighwayMPG))
        .attr('r', (d, _) => parseInt(d.EngineCylinders) + 2);

      d3.select('svg').append("g")
        .attr("transform", "translate(" + margin + "," + margin + ")")
        .call(d3.axisLeft(y)
          .tickValues([10, 20, 50, 100])
          .tickFormat((d, _) => d3.format("~s")(d)));
      d3.select('svg').append("g")
        .attr("transform", "translate(" + margin + "," + (margin + height) + ")")
        .call(d3.axisBottom(x)
          .tickValues([10, 20, 50, 100])
          .tickFormat((d, _) => d3.format("~s")(d)));
    }
  </script>
</body>

</html>